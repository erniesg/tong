import{G as _,u as a,d as l,y as A}from"./chunks/hooks.module.CvzeXvhM.js";const b={ko:"Korean",ja:"Japanese",zh:"Chinese",en:"English"};function M(){const[t,o]=l(null),[E,v]=l(!0),[m,p]=l(!0),[u,w]=l(!1),[y,T]=l([]),[N,h]=l(null),[g,r]=l(null);A(()=>{f(),k()},[]);const f=async()=>{try{const e=await chrome.runtime.sendMessage({type:"GET_PREFERENCES"});e.success&&o(e.data)}catch(e){console.error("Error loading preferences:",e)}finally{v(!1)}},k=async()=>{try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(e!=null&&e.id){const s=await chrome.tabs.sendMessage(e.id,{type:"GET_OVERLAY_STATE"});s!=null&&s.success&&(p(s.data.isVisible),w(s.data.hasOverlay),r(s.data.detectedLanguage||null));const n=await chrome.tabs.sendMessage(e.id,{type:"GET_TRACKS"});n!=null&&n.success&&(T(n.data.tracks||[]),h(n.data.selectedTrackId||null),n.data.detectedLanguage&&r(n.data.detectedLanguage))}}catch{}},C=async()=>{try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(e!=null&&e.id){const s=await chrome.tabs.sendMessage(e.id,{type:"TOGGLE_OVERLAY"});s!=null&&s.success&&p(s.data.isVisible)}}catch{}},d=async e=>{if(!t)return;const s={subtitles:{...t.subtitles,[e]:!t.subtitles[e]}};if((await chrome.runtime.sendMessage({type:"SET_PREFERENCES",payload:s})).success){o({...t,...s});const[i]=await chrome.tabs.query({active:!0,currentWindow:!0});i!=null&&i.id&&await chrome.tabs.sendMessage(i.id,{type:"UPDATE_PREFERENCES"})}},S=async e=>{if(!t)return;const s={languages:{...t.languages,primaryTarget:e}};if((await chrome.runtime.sendMessage({type:"SET_PREFERENCES",payload:s})).success){o({...t,...s});const[i]=await chrome.tabs.query({active:!0,currentWindow:!0});i!=null&&i.id&&(await chrome.tabs.sendMessage(i.id,{type:"UPDATE_PREFERENCES"}),setTimeout(async()=>{try{const c=await chrome.tabs.sendMessage(i.id,{type:"GET_TRACKS"});c!=null&&c.success&&(h(c.data.selectedTrackId||null),r(c.data.detectedLanguage||null))}catch{}},500))}},L=async e=>{if(!t)return;const s={languages:{...t.languages,translationLanguage:e}};if((await chrome.runtime.sendMessage({type:"SET_PREFERENCES",payload:s})).success){o({...t,...s});const[i]=await chrome.tabs.query({active:!0,currentWindow:!0});i!=null&&i.id&&await chrome.tabs.sendMessage(i.id,{type:"UPDATE_PREFERENCES"})}},R=async e=>{try{const[s]=await chrome.tabs.query({active:!0,currentWindow:!0});if(s!=null&&s.id){const n=await chrome.tabs.sendMessage(s.id,{type:"CHANGE_TRACK",payload:{trackId:e}});n!=null&&n.success&&(h(e),r(n.data.detectedLanguage||null))}}catch{}},P=()=>{chrome.runtime.openOptionsPage()};return E?a("div",{className:"popup",children:a("div",{className:"loading",children:"Loading..."})}):a("div",{className:"popup",children:[a("header",{className:"header",children:[a("h1",{children:"Tong"}),a("span",{className:"version",children:"v0.1.0"})]}),a("main",{className:"content",children:[a("section",{className:"quick-toggles",children:[a("button",{className:`toggle-btn primary${m?" active":""}`,onClick:C,disabled:!u,title:u?"":"Navigate to a video page first",children:u?m?"Hide Subtitles":"Show Subtitles":"No Video Detected"}),a("div",{className:"toggle-row",children:[a("label",{children:[a("input",{type:"checkbox",checked:t==null?void 0:t.subtitles.showOriginal,onChange:()=>d("showOriginal")}),"Original"]}),a("label",{children:[a("input",{type:"checkbox",checked:t==null?void 0:t.subtitles.showRomanization,onChange:()=>d("showRomanization")}),"Romanization"]}),a("label",{children:[a("input",{type:"checkbox",checked:t==null?void 0:t.subtitles.showTranslation,onChange:()=>d("showTranslation")}),"Translation"]})]}),a("div",{className:"toggle-row",children:a("label",{children:[a("input",{type:"checkbox",checked:t==null?void 0:t.subtitles.karaokeEnabled,onChange:()=>d("karaokeEnabled")}),"Karaoke Mode"]})})]}),a("section",{className:"language-info",children:[a("div",{className:"info-row",children:[a("span",{className:"label",children:"Learning:"}),a("select",{className:"lang-select",value:(t==null?void 0:t.languages.primaryTarget)||"ko",onChange:e=>S(e.target.value),children:[a("option",{value:"ko",children:"Korean"}),a("option",{value:"ja",children:"Japanese"}),a("option",{value:"zh",children:"Chinese (Simplified)"}),a("option",{value:"zh-TW",children:"Chinese (Traditional)"})]})]}),a("div",{className:"info-row",children:[a("span",{className:"label",children:"Translate to:"}),a("select",{className:"lang-select",value:(t==null?void 0:t.languages.translationLanguage)||"en",onChange:e=>L(e.target.value),children:[{value:"en",label:"English"},{value:"zh",label:"Chinese (Simplified)"},{value:"zh-TW",label:"Chinese (Traditional)"},{value:"ko",label:"Korean"},{value:"ja",label:"Japanese"}].filter(e=>{const s=(t==null?void 0:t.languages.primaryTarget)||"";return!(e.value===s||e.value==="zh"&&s==="zh-TW"||e.value==="zh-TW"&&s==="zh")}).map(e=>a("option",{value:e.value,children:e.label},e.value))})]}),y.length>0&&a("div",{className:"info-row",children:[a("span",{className:"label",children:"Subtitle track:"}),a("select",{className:"lang-select",value:N||"",onChange:e=>R(e.target.value),children:y.map(e=>a("option",{value:e.id,children:[e.label||b[e.language]||e.language,e.isAutoGenerated?" (auto)":""]},e.id))})]}),g&&a("div",{className:"info-row",children:[a("span",{className:"label",children:"Detected:"}),a("span",{className:"value",children:b[g]||g.toUpperCase()})]})]})]}),a("footer",{className:"footer",children:a("button",{className:"settings-btn",onClick:P,children:"Settings"})})]})}_(a(M,{}),document.getElementById("app"));
